<% provide(:title, "Solar Readings") %>
<% provide(:description, "The amount of electricity generated by our solar panels.") %>

<h1>Solar Readings</h1>
<ol class="breadcrumb">
	<li class="active">Solar Readings</li>
	<li><%= link_to "Statistics", solar_readings_stats_path %></li>
</ol>

<section class="row">
	<article class="col-md-8">
		<table class="table table-striped">
			<% @readings.each do |reading| %>
			<tr>
				<td><%= link_to reading.date, solar_reading_path(reading) %></td>
				<td><%= reading.kwh %></td>
			</tr>
			<% end %>
		</table>
		<%= paginate @readings %>
	</article>
	<article class="col-md-4">
		<div class="well">
			<h4>Total Generated</h4>
			<h2><%= @total %></h2>
		</div>
	<% if current_user and current_user.admin %>
		<section id="drop">Upload solar CSV</section>
		<script>
			// <![CDATA[
			$(document).ready(function() {
				var holder = document.getElementById('drop');
				holder.ondragover = function () { this.className = 'hover'; return false; };
				holder.ondragend = function () { this.className = ''; return false; };
				holder.ondragleave = function () { this.className = ''; return false; };
				holder.ondrop = function(e) {
					e.preventDefault();
					this.className = '';
					var file = e.dataTransfer.files[0];
					var reader = new FileReader();
					$('#drop').html('Reading File...');
					reader.onload = function (event) {
						$('#drop').html('Uploading...');
						$.post('<%= solar_readings_path %>.json', { file: event.target.result }, function(data) {
							$('#drop').html('<h2>Success!</h2>');
							console.log(data);
						});
					};
					reader.readAsDataURL(file);
					return false;
				};
			});
			//]]!>
		</script>
	<% end %>
	</article>
</section>
